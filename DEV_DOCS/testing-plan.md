# isQCoder-cli 综合测试计划

> **版本:** v1.0 | **日期:** 2026-02-26 | **状态:** Phase 6 预备 **适用范围:**
> isQCoder-cli 全链路可用性验证（TypeScript CLI + Python MCP Server）

---

## 1. 测试目标

验证 isQCoder-cli 作为量子计算终端 AI 编程助手的**端到端可用性**，覆盖以下核心目标：

1. **基础功能完整性** — 从 Gemini CLI 继承的所有核心功能正常工作
2. **品牌替换一致性** — 所有用户可见的文案、路径、命令名均已正确替换
3. **量子计算功能正确性** — isQ 编译/模拟、isqtools 调用链、知识检索等功能可用
4. **MCP Server 集成可靠性** — CLI ↔ Python MCP Server 的全链路通信正常
5. **LLM 提供商兼容性** — Gemini API 和 Zhipu GLM 两个 LLM 后端均可正常使用
6. **跨环境一致性** — 在目标部署环境（Linux 工作站 + Docker）上表现一致

---

## 2. 测试环境

### 2.1 硬件 & 系统

| 项目     | 要求                                              |
| -------- | ------------------------------------------------- |
| 操作系统 | Linux（主开发环境：Ubuntu/Debian，`/home/alba/`） |
| Node.js  | ≥ 20.x                                            |
| Python   | ≥ 3.10                                            |
| Docker   | ≥ 24.x（用于 isQ 编译沙箱和 isqtools 执行）       |
| 内存     | ≥ 8 GB（Qdrant + Docker 容器）                    |

### 2.2 依赖服务

| 服务          | 用途                   | 环境变量 / 配置                    |
| ------------- | ---------------------- | ---------------------------------- |
| Gemini API    | 主 LLM 提供商          | `GEMINI_API_KEY`                   |
| Zhipu GLM API | 备选 LLM 提供商        | `ZHIPU_API_KEY`                    |
| Docker Engine | isQ 编译/模拟沙箱      | `ISQC_DOCKER_IMAGE`                |
| Qdrant        | RAG 向量数据库         | Docker Compose 中启动              |
| isQCodeAgent  | Python MCP Server 后端 | `~/.isqcoder/settings.json` 中配置 |

### 2.3 Docker 镜像

| 镜像名称                            | 用途               |
| ----------------------------------- | ------------------ |
| `arclightquantum/isqc:ubuntu-0.0.1` | isQ 编译器运行环境 |
| `isqc-python:latest`                | isqtools 执行环境  |
| `qdrant/qdrant:latest`              | RAG 向量数据库     |

---

## 3. 测试层次总览

```
┌─────────────────────────────────────────────────────────────────┐
│  L5  端到端场景测试 (E2E Scenario Tests)                        │
│       完整用户工作流 · 量子编程任务 · 多轮对话                   │
├─────────────────────────────────────────────────────────────────┤
│  L4  集成测试 (Integration Tests)                               │
│       CLI ↔ MCP Server · LLM 调用 · Docker 沙箱                │
├─────────────────────────────────────────────────────────────────┤
│  L3  组件测试 (Component Tests)                                 │
│       React/Ink UI 组件 · Slash 命令 · 配置加载                 │
├─────────────────────────────────────────────────────────────────┤
│  L2  单元测试 (Unit Tests)                                      │
│       工具函数 · 提示词生成 · 语法高亮 · 路径解析               │
├─────────────────────────────────────────────────────────────────┤
│  L1  构建与静态检查 (Build & Static Analysis)                   │
│       TypeScript 编译 · ESLint · Prettier · 类型检查            │
└─────────────────────────────────────────────────────────────────┘
```

---

## 4. 测试阶段与详细用例

### 4.1 L1 — 构建与静态检查

> **目的：** 确保代码可以正确编译、打包，无类型错误和风格问题。

| 编号  | 测试项              | 执行命令                    | 预期结果                                                          |
| ----- | ------------------- | --------------------------- | ----------------------------------------------------------------- |
| L1-01 | 依赖安装            | `npm install`               | 所有 workspace 依赖安装成功，无 peer dep 告警                     |
| L1-02 | TypeScript 类型检查 | `npm run typecheck`         | 所有包类型检查通过，0 错误                                        |
| L1-03 | ESLint 检查         | `npm run lint`              | 0 error，warning 数量可控                                         |
| L1-04 | Prettier 格式检查   | `npm run format -- --check` | 所有文件格式一致                                                  |
| L1-05 | 构建打包            | `npm run build`             | 所有包编译成功                                                    |
| L1-06 | esbuild 打包        | `npm run bundle`            | 生成 `bundle/isqcoder.js`，文件大小合理                           |
| L1-07 | 全链路质量门        | `npm run preflight`         | clean → install → format → build → lint → typecheck → test 全通过 |

### 4.2 L2 — 单元测试

> **目的：** 验证各模块的独立功能正确性。

#### 4.2.1 品牌替换验证

| 编号  | 测试项       | 验证方法                                       | 预期结果                                     |
| ----- | ------------ | ---------------------------------------------- | -------------------------------------------- |
| L2-01 | 配置目录名称 | 检查 `ISQCODER_DIR` 常量值                     | 值为 `.isqcoder`                             |
| L2-02 | 上下文文件名 | 检查 `DEFAULT_CONTEXT_FILENAME` 常量值         | 值为 `ISQCODER.md`                           |
| L2-03 | 内存段标题   | 检查 memory section header                     | 包含 `isQCoder`                              |
| L2-04 | 包名引用     | 全局搜索 `@google/gemini-cli` 残留             | 源码中不存在旧包名引用（保留的兼容别名除外） |
| L2-05 | 二进制入口   | 检查 root `package.json` 的 `bin` 字段         | 值为 `isqcoder` → `bundle/isqcoder.js`       |
| L2-06 | 系统设置路径 | 检查 Linux/Windows 系统设置路径常量            | Linux: `/etc/isqcoder/settings.json`         |
| L2-07 | ASCII 标志   | 渲染 AsciiArt 组件（short/long/tiny 三种变体） | 输出包含 `isQCoder` 文案                     |
| L2-08 | 提示文案     | 检查 Tips 组件输出                             | 不包含 `Gemini CLI` 字样                     |

#### 4.2.2 isQ 语法高亮

| 编号  | 测试项             | 验证方法                                                     | 预期结果                   |
| ----- | ------------------ | ------------------------------------------------------------ | -------------------------- |
| L2-09 | 语言定义注册       | `lowlight` 注册 `isq` 语言后 `listLanguages()` 含 `isq`      | 注册成功                   |
| L2-10 | 关键字高亮         | 对含 `procedure`, `qbit`, `ctrl`, `deriving gate` 的代码高亮 | 关键字被正确分类和标注     |
| L2-11 | 量子门内置函数     | 对含 `H`, `CNOT`, `Toffoli`, `Rx` 的代码高亮                 | 内置函数被正确识别         |
| L2-12 | CodeColorizer 集成 | `CodeColorizer` 处理 `isq` 语言代码块                        | 输出带 ANSI 颜色的终端文本 |

#### 4.2.3 System Prompt 生成

| 编号  | 测试项              | 验证方法                             | 预期结果                                      |
| ----- | ------------------- | ------------------------------------ | --------------------------------------------- |
| L2-13 | isQ 知识注入        | 调用 `renderIsqKnowledge()` 函数     | 返回包含 isQ 语法规则、量子门列表的文本       |
| L2-14 | isqtools 工作流注入 | 调用 `renderIsqtoolsWorkflow()` 函数 | 返回包含 3 种编程模式、调用步骤的文本         |
| L2-15 | Prompt 始终启用     | 检查 promptProvider 配置             | `isqKnowledge` 和 `isqtoolsWorkflow` 始终启用 |
| L2-16 | 身份标识            | 获取完整 system prompt               | 包含 "isQCoder" 和 "quantum computing" 描述   |

#### 4.2.4 静态知识资源

| 编号  | 测试项            | 验证方法                         | 预期结果                                         |
| ----- | ----------------- | -------------------------------- | ------------------------------------------------ |
| L2-17 | isQ 快速参考文档  | 读取 `isq-quick-reference.md`    | 文档存在且包含类型定义、量子门用法               |
| L2-18 | isqtools 快速入门 | 读取 `isqtools-quick-start.md`   | 文档存在且包含安装说明、API 用法                 |
| L2-19 | 量子算法模式      | 读取 `quantum-patterns.md`       | 包含 Bell State、GHZ、Grover、量子隐形传态等示例 |
| L2-20 | 资源注册表        | 检查 `resource-registry.ts` 导出 | 所有 3 个资源文件均已注册                        |

#### 4.2.5 Zhipu 内容生成器

| 编号  | 测试项            | 验证方法                            | 预期结果                                 |
| ----- | ----------------- | ----------------------------------- | ---------------------------------------- |
| L2-21 | 类实例化          | `new ZhipuContentGenerator(apiKey)` | 无异常，默认模型为 `glm-5`               |
| L2-22 | Token 计数        | `countTokens()` 对中英文文本        | 返回基于字符的估算值（中文: 字符数×1.5） |
| L2-23 | API Base URL 覆盖 | 设置 `ZHIPU_API_BASE_URL` 环境变量  | 使用自定义地址而非默认地址               |
| L2-24 | Auth 类型检测     | 设置 `ZHIPU_API_KEY` 环境变量       | `getAuthTypeFromEnv()` 返回 `USE_ZHIPU`  |

#### 4.2.6 现有单元测试回归

| 编号  | 测试项                | 执行命令                              | 预期结果     |
| ----- | --------------------- | ------------------------------------- | ------------ |
| L2-25 | CLI 包单元测试        | `npm run test -w packages/cli`        | 所有测试通过 |
| L2-26 | Core 包单元测试       | `npm run test -w packages/core`       | 所有测试通过 |
| L2-27 | SDK 包单元测试        | `npm run test -w packages/sdk`        | 所有测试通过 |
| L2-28 | Test-Utils 包单元测试 | `npm run test -w packages/test-utils` | 所有测试通过 |
| L2-29 | 脚本测试              | `npm run test:scripts`                | 所有测试通过 |

### 4.3 L3 — 组件测试

> **目的：** 验证 UI 组件、Slash 命令、配置系统的交互行为。

#### 4.3.1 认证流程

| 编号  | 测试项          | 验证方法                  | 预期结果                                      |
| ----- | --------------- | ------------------------- | --------------------------------------------- |
| L3-01 | AuthDialog 展示 | 渲染 AuthDialog 组件      | 显示 Gemini API Key 和 Zhipu API Key 两个选项 |
| L3-02 | Gemini API 认证 | 输入有效 `GEMINI_API_KEY` | 认证成功，进入主界面                          |
| L3-03 | Zhipu API 认证  | 输入有效 `ZHIPU_API_KEY`  | 认证成功，进入主界面                          |
| L3-04 | 无效 Key 处理   | 输入无效 API Key          | 显示友好错误信息，允许重试                    |
| L3-05 | 非交互模式认证  | 通过环境变量预设 Key 启动 | 跳过认证对话框，直接进入                      |

#### 4.3.2 量子 Slash 命令

| 编号  | 测试项                 | 验证方法                                  | 预期结果                                 |
| ----- | ---------------------- | ----------------------------------------- | ---------------------------------------- |
| L3-06 | `/qrun` 命令注册       | 检查 BuiltinCommandLoader                 | 命令已注册，help 文本正确                |
| L3-07 | `/qfix` 命令注册       | 检查 BuiltinCommandLoader                 | 命令已注册，help 文本正确                |
| L3-08 | `/qpy` 命令注册        | 检查 BuiltinCommandLoader                 | 命令已注册，help 文本正确                |
| L3-09 | `/qsearch` 命令注册    | 检查 BuiltinCommandLoader                 | 命令已注册，help 文本正确                |
| L3-10 | `/qtemplate` 命令注册  | 检查 BuiltinCommandLoader                 | 命令已注册，help 文本正确                |
| L3-11 | `/qenv` 命令注册       | 检查 BuiltinCommandLoader                 | 命令已注册，help 文本正确                |
| L3-12 | Tab 补全 — `.isq` 文件 | 在含 `.isq` 文件的目录中触发 `/qrun` 补全 | 列出当前目录所有 `.isq` 文件             |
| L3-13 | Tab 补全 — `.py` 文件  | 在含 `.py` 文件的目录中触发 `/qpy` 补全   | 列出当前目录所有 `.py` 文件              |
| L3-14 | `/qtemplate` 模板列表  | 不带参数执行 `/qtemplate`                 | 列出所有可用模板（bell, ghz, grover 等） |
| L3-15 | 缺少参数提示           | 执行 `/qrun`（不带文件名）                | 显示使用说明而非崩溃                     |

#### 4.3.3 配置系统

| 编号  | 测试项             | 验证方法                         | 预期结果                     |
| ----- | ------------------ | -------------------------------- | ---------------------------- |
| L3-16 | settings.json 加载 | 读取 `~/.isqcoder/settings.json` | 正确解析 MCP Server 配置     |
| L3-17 | MCP Server 配置    | 配置 `mcpServers.isqcoder` 段    | 识别 isQCodeAgent MCP Server |
| L3-18 | 扩展管理           | 通过 extension-manager 加载扩展  | 扩展加载不影响核心功能       |
| L3-19 | ISQCODER.md 加载   | 在项目目录放置 `ISQCODER.md`     | 内容被注入到上下文中         |
| L3-20 | 文件夹信任机制     | 首次进入新目录                   | 弹出信任确认提示             |

#### 4.3.4 UI 展示

| 编号  | 测试项       | 验证方法                  | 预期结果                     |
| ----- | ------------ | ------------------------- | ---------------------------- |
| L3-21 | 启动画面     | 运行 `isqcoder`           | 显示 isQCoder ASCII Art 标志 |
| L3-22 | 帮助信息     | 运行 `isqcoder --help`    | 显示 isQCoder 相关的帮助信息 |
| L3-23 | 版本信息     | 运行 `isqcoder --version` | 显示正确的版本号             |
| L3-24 | Tips 展示    | 观察启动后的 Tips         | 包含量子计算相关提示         |
| L3-25 | isQ 代码渲染 | 在对话中生成 isQ 代码块   | 代码带有语法高亮着色         |

### 4.4 L4 — 集成测试

> **目的：** 验证跨进程、跨语言组件间的通信和协作。

#### 4.4.1 MCP Server 连接

| 编号  | 测试项              | 验证方法                             | 预期结果                                 |
| ----- | ------------------- | ------------------------------------ | ---------------------------------------- |
| L4-01 | MCP Server 启动     | CLI 启动时自动拉起 Python MCP Server | 进程启动成功，stdio 通道建立             |
| L4-02 | Tool 列表发现       | CLI 向 MCP Server 请求 `tools/list`  | 返回 8 个工具定义（含名称、参数 schema） |
| L4-03 | MCP Server 异常恢复 | 杀死 MCP Server 进程后重新调用       | CLI 显示友好错误信息，支持重连或重试     |
| L4-04 | MCP Server 超时处理 | MCP Server 响应延迟超过阈值          | CLI 超时后给出提示，不阻塞主进程         |
| L4-05 | 多 MCP Server 共存  | 同时配置 isqcoder + 其他 MCP Server  | 互不干扰，工具名不冲突                   |

#### 4.4.2 isQ 编译 & 模拟

| 编号  | 测试项              | 验证方法                                 | 预期结果                                 |
| ----- | ------------------- | ---------------------------------------- | ---------------------------------------- | ------- | --------------- |
| L4-06 | 正确代码编译        | `isq_compile` 对 `bell_state.isq`        | 返回编译成功状态                         |
| L4-07 | 错误代码编译        | `isq_compile` 对含语法错误的 `.isq` 文件 | 返回结构化编译错误信息（行号、错误类型） |
| L4-08 | 量子模拟            | `isq_simulate` 对 Bell State 代码        | 返回概率分布（`                          | 00⟩`和` | 11⟩` 各约 50%） |
| L4-09 | 模拟结果可视化      | 查看 `isq_simulate` 的格式化输出         | 包含 ASCII 概率条形图                    |
| L4-10 | Docker 容器生命周期 | 编译/模拟操作前后检查容器状态            | 操作完成后容器正确清理                   |

#### 4.4.3 isqtools 调用链

| 编号  | 测试项                | 验证方法                                              | 预期结果                               |
| ----- | --------------------- | ----------------------------------------------------- | -------------------------------------- |
| L4-11 | Python + isQ 联合执行 | `isqtools_run` 执行含 `isqtools.run()` 的 Python 脚本 | Python 调用 isQ 编译并返回结果         |
| L4-12 | isQ 文件自动发现      | `isqtools_run` 带 `isq_files` 参数                    | 指定的 `.isq` 文件被注入到 Docker 容器 |
| L4-13 | 执行超时              | `isqtools_run` 执行耗时超长的代码                     | 超时后优雅终止，返回超时错误           |
| L4-14 | 沙箱隔离              | `isqtools_run` 中尝试访问宿主文件系统                 | 被 Docker 沙箱阻止，无法越权访问       |

#### 4.4.4 自动修复循环

| 编号  | 测试项                          | 验证方法                                     | 预期结果                                    |
| ----- | ------------------------------- | -------------------------------------------- | ------------------------------------------- |
| L4-15 | isQ 编译自动修复                | `isq_auto_fix` 对含简单错误的 isQ 代码       | 返回修复后的代码和修复说明                  |
| L4-16 | isqtools 自动修复 — 编译错误    | `isqtools_auto_fix` 对 isQ 编译错误          | 分类为 `isq_compile`，调用 multi-agent 修复 |
| L4-17 | isqtools 自动修复 — Python 错误 | `isqtools_auto_fix` 对 Python 运行时错误     | 分类为 `python_runtime`，返回结构化诊断     |
| L4-18 | isqtools 自动修复 — API 错误    | `isqtools_auto_fix` 对 isqtools API 用法错误 | 分类为 `isqtools_api`，返回 RAG 检索结果    |
| L4-19 | isqtools 自动修复 — 超时        | `isqtools_auto_fix` 对超时错误               | 分类为 `timeout`，立即中止                  |

#### 4.4.5 RAG 知识检索

| 编号  | 测试项        | 验证方法                                | 预期结果                              |
| ----- | ------------- | --------------------------------------- | ------------------------------------- |
| L4-20 | 知识搜索      | `isq_rag_search` 搜索 "Bell State"      | 返回相关文档片段（97 篇文档库中检索） |
| L4-21 | 中文查询      | `isq_rag_search` 搜索 "量子纠缠"        | 返回中文相关内容                      |
| L4-22 | 空结果处理    | `isq_rag_search` 搜索无关关键词         | 返回空结果或低置信度提示              |
| L4-23 | Qdrant 不可用 | 在 Qdrant 未启动时调用 `isq_rag_search` | 返回友好错误信息，不崩溃              |

#### 4.4.6 快速路径 & 规则

| 编号  | 测试项       | 验证方法                         | 预期结果                             |
| ----- | ------------ | -------------------------------- | ------------------------------------ |
| L4-24 | 模板匹配     | `isq_fast_path` 请求 "bell" 模板 | 返回 Bell State 代码模板，0 LLM 调用 |
| L4-25 | 所有模板覆盖 | 逐一测试 11 个快速路径模板       | 所有模板均返回正确代码               |
| L4-26 | 规则查询     | `isq_rules_query` 查询已有规则   | 返回规则列表                         |

#### 4.4.7 LLM 集成

| 编号  | 测试项          | 验证方法                                   | 预期结果                             |
| ----- | --------------- | ------------------------------------------ | ------------------------------------ |
| L4-27 | Gemini API 对话 | 使用 `GEMINI_API_KEY` 发送对话请求         | 流式返回响应，含量子计算上下文       |
| L4-28 | Zhipu GLM 对话  | 使用 `ZHIPU_API_KEY` 发送对话请求          | 流式返回响应（SSE），工具调用正常    |
| L4-29 | Zhipu 工具调用  | 通过 Zhipu 触发 MCP 工具                   | 工具参数正确传递，结果正确返回给模型 |
| L4-30 | LLM 切换        | 从 Gemini 切换到 Zhipu（更换环境变量重启） | 两者均可正常驱动完整工作流           |

#### 4.4.8 继承功能回归

| 编号  | 测试项                     | 执行命令                                  | 预期结果                |
| ----- | -------------------------- | ----------------------------------------- | ----------------------- |
| L4-31 | 集成测试套件 — 无沙箱      | `npm run test:integration:sandbox:none`   | 所有继承的集成测试通过  |
| L4-32 | 集成测试套件 — Docker 沙箱 | `npm run test:integration:sandbox:docker` | 所有继承的集成测试通过  |
| L4-33 | E2E 测试套件               | `npm run test:e2e`                        | 所有继承的 E2E 测试通过 |

### 4.5 L5 — 端到端场景测试

> **目的：** 模拟真实用户操作流程，验证完整工作流。

#### 场景 S1：首次启动与配置

| 步骤 | 操作                      | 预期结果                              |
| ---- | ------------------------- | ------------------------------------- |
| 1    | 首次运行 `isqcoder`       | 显示 ASCII 标志，弹出认证对话框       |
| 2    | 选择 Zhipu API Key 并输入 | 认证成功，创建 `~/.isqcoder/` 目录    |
| 3    | 进入一个新项目目录        | 弹出文件夹信任提示                    |
| 4    | 信任后输入 `/help`        | 显示帮助信息，包含量子命令列表        |
| 5    | 执行 `/qenv`              | 显示环境状态（Docker、MCP Server 等） |

#### 场景 S2：isQ 代码开发完整流程

| 步骤 | 操作                                      | 预期结果                               |
| ---- | ----------------------------------------- | -------------------------------------- |
| 1    | 对话："帮我写一个 Bell State 的 isQ 程序" | LLM 生成含 `H`, `CNOT` 的 isQ 代码     |
| 2    | 代码在终端以语法高亮渲染                  | `procedure`, `qbit`, `H` 等关键字着色  |
| 3    | 将代码保存为 `bell.isq`                   | 文件写入成功                           |
| 4    | 执行 `/qrun bell.isq`                     | 编译成功 → 模拟运行 → 返回概率分布     |
| 5    | 查看概率条形图                            | ASCII 图表显示 \|00⟩ 和 \|11⟩ 各约 50% |

#### 场景 S3：编译错误修复循环

| 步骤 | 操作                             | 预期结果                                     |
| ---- | -------------------------------- | -------------------------------------------- |
| 1    | 创建含语法错误的 `broken.isq`    | 文件保存成功                                 |
| 2    | 执行 `/qrun broken.isq`          | 编译失败，显示错误信息                       |
| 3    | 执行 `/qfix broken.isq`          | 自动修复循环启动，返回修正后的代码和修复说明 |
| 4    | 用修复后的代码替换并重新 `/qrun` | 编译通过，模拟正常运行                       |

#### 场景 S4：isqtools Python 混合编程

| 步骤 | 操作                                           | 预期结果                                                 |
| ---- | ---------------------------------------------- | -------------------------------------------------------- |
| 1    | 对话："帮我用 Python isqtools 运行 Bell State" | LLM 生成 `.py` 文件（含 `isqtools.run()`）和 `.isq` 文件 |
| 2    | 保存文件到当前目录                             | 两个文件写入成功                                         |
| 3    | 执行 `/qpy run_bell.py`                        | 自动发现同目录 `.isq` 文件，Docker 中执行                |
| 4    | 查看 Python 输出                               | 显示量子模拟结果                                         |
| 5    | 如有错误，对话："帮我修复"                     | LLM 调用 `isqtools_auto_fix` 分析错误并修复              |

#### 场景 S5：知识检索辅助编程

| 步骤 | 操作                                         | 预期结果                             |
| ---- | -------------------------------------------- | ------------------------------------ |
| 1    | 执行 `/qsearch Grover算法`                   | 返回 Grover 搜索相关的知识片段       |
| 2    | 对话："根据上面的知识，帮我实现 Grover 搜索" | LLM 结合 RAG 结果生成正确的 isQ 代码 |
| 3    | 执行 `/qtemplate grover`                     | 返回 Grover 搜索代码模板             |
| 4    | 对比 LLM 生成和模板                          | 两者结构一致，关键量子门正确         |

#### 场景 S6：多轮对话与上下文保持

| 步骤 | 操作                                | 预期结果                                |
| ---- | ----------------------------------- | --------------------------------------- |
| 1    | 对话："创建一个 3-qubit GHZ 态程序" | 生成正确的 GHZ 代码                     |
| 2    | 对话："把它改成 5-qubit"            | 在上下文中修改为 5-qubit 版本           |
| 3    | 对话："加上测量和打印"              | 在之前代码基础上添加 `M` 和 `print`     |
| 4    | 对话："编译运行一下"                | LLM 调用 `isq_compile` + `isq_simulate` |

#### 场景 S7：错误容错与异常恢复

| 步骤 | 操作                                    | 预期结果                                    |
| ---- | --------------------------------------- | ------------------------------------------- |
| 1    | 在 Docker 未启动时执行 `/qrun test.isq` | 显示友好错误信息（"Docker 未运行"类似提示） |
| 2    | 在 MCP Server 配置错误时启动            | 显示 MCP 连接失败信息，基础对话功能不受影响 |
| 3    | 在无网络时使用 LLM 对话                 | 显示网络错误提示，不崩溃                    |
| 4    | 在 Qdrant 未启动时执行 `/qsearch`       | 显示 RAG 服务不可用提示                     |

---

## 5. 测试数据

### 5.1 isQ 测试文件

| 文件名              | 用途              | 内容描述                                   |
| ------------------- | ----------------- | ------------------------------------------ |
| `bell_state.isq`    | 基础编译/模拟测试 | 标准 Bell State 程序（已存在于仓库根目录） |
| `syntax_error.isq`  | 编译错误测试      | 含故意语法错误的代码                       |
| `ghz_state.isq`     | 多量子比特测试    | 3-qubit GHZ 态                             |
| `grover_search.isq` | 复杂算法测试      | Grover 搜索算法实现                        |
| `teleportation.isq` | 量子通信测试      | 量子隐形传态实现                           |
| `timeout_loop.isq`  | 超时测试          | 含无限循环的代码                           |

### 5.2 Python 测试文件

| 文件名              | 用途              | 内容描述                              |
| ------------------- | ----------------- | ------------------------------------- |
| `run_bell.py`       | isqtools 基础调用 | 使用 `isqtools.run()` 编译 Bell State |
| `run_with_error.py` | Python 错误测试   | 含 Python 运行时错误的脚本            |
| `bad_api_usage.py`  | API 用法错误测试  | isqtools API 参数错误                 |

---

## 6. 测试优先级

按照风险和重要性排序：

| 优先级 | 测试范围                     | 原因                                     |
| ------ | ---------------------------- | ---------------------------------------- |
| **P0** | L1 构建与静态检查            | 构建失败则一切无从谈起                   |
| **P0** | L2-25~L2-29 现有单元测试回归 | 确保品牌替换未破坏已有功能               |
| **P1** | L4-01~L4-05 MCP Server 连接  | MCP 是核心集成方式，连不上则量子功能全废 |
| **P1** | L4-06~L4-09 isQ 编译模拟     | 量子编程核心功能                         |
| **P1** | L2-01~L2-08 品牌替换验证     | 用户第一印象，任何残留都影响产品专业性   |
| **P2** | L4-11~L4-14 isqtools 调用链  | Python + isQ 混合编程是核心差异化功能    |
| **P2** | L3-06~L3-15 Slash 命令       | 主要用户交互入口                         |
| **P2** | L4-27~L4-30 LLM 集成         | 双 LLM 后端兼容性                        |
| **P3** | L4-15~L4-19 自动修复循环     | 高级功能，增强体验但非必须               |
| **P3** | L4-20~L4-26 RAG & 快速路径   | 知识增强功能，提高准确性但有降级方案     |
| **P3** | L5 端到端场景                | 综合验证，确保真实用户体验               |

---

## 7. 测试执行顺序

```
Phase 1: 构建验证（约 0.5 天）
    └── L1-01 ~ L1-07：安装、编译、打包、全链路质量门

Phase 2: 单元回归（约 1 天）
    ├── L2-25 ~ L2-29：跑通所有已有单元测试
    └── L2-01 ~ L2-24：新增功能的单元验证

Phase 3: 组件与配置（约 1 天）
    ├── L3-01 ~ L3-05：认证流程
    ├── L3-06 ~ L3-15：Slash 命令
    ├── L3-16 ~ L3-20：配置系统
    └── L3-21 ~ L3-25：UI 展示

Phase 4: 集成测试（约 2 天）
    ├── L4-01 ~ L4-05：MCP Server 连接
    ├── L4-06 ~ L4-10：isQ 编译与模拟
    ├── L4-11 ~ L4-14：isqtools 调用链
    ├── L4-15 ~ L4-19：自动修复循环
    ├── L4-20 ~ L4-26：RAG 与快速路径
    ├── L4-27 ~ L4-30：LLM 集成
    └── L4-31 ~ L4-33：继承功能回归

Phase 5: 端到端场景（约 1.5 天）
    └── S1 ~ S7：完整用户场景
```

**预计总测试周期：约 6 天**

---

## 8. 通过标准

### 8.1 发布阻塞条件（Must Fix）

- [ ] L1 构建与静态检查全部通过
- [ ] L2 现有单元测试 0 失败
- [ ] L4-01~L4-02 MCP Server 连接和工具发现正常
- [ ] L4-06~L4-08 isQ 编译和模拟功能正常
- [ ] S2 isQ 代码开发完整流程走通
- [ ] 品牌替换无用户可见残留

### 8.2 降级发布条件（Known Issues）

以下问题可记录为 Known Issues 后发布：

- RAG 搜索在 Qdrant 未部署时不可用（提供文档说明）
- 自动修复对复杂错误的修复率未达预期（可手动修改）
- 部分快速路径模板内容不够完善

### 8.3 测试报告模板

每个测试项完成后记录：

```markdown
| 编号  | 状态  | 实际结果 | 备注   |
| ----- | ----- | -------- | ------ |
| L1-01 | ✅/❌ | [描述]   | [如有] |
```

---

## 9. 风险项与缓解

| 风险                                   | 影响                     | 缓解措施                                           |
| -------------------------------------- | ------------------------ | -------------------------------------------------- |
| Docker 环境不一致                      | 编译/模拟测试无法执行    | 提前验证 Docker 镜像可用性（L4-10）                |
| LLM API 配额限制                       | 集成测试中断             | 使用 mock 覆盖高频测试，真实 API 仅用于关键场景    |
| isQCodeAgent Python 环境依赖复杂       | MCP Server 启动失败      | 使用 `requirements.txt` 锁定依赖版本               |
| Qdrant 数据库未初始化                  | RAG 测试失败             | 测试前执行 `docker-compose up qdrant` + 索引初始化 |
| 上游 Gemini CLI 已有测试与品牌替换冲突 | 部分继承测试硬编码旧名称 | 逐个排查修复失败的继承测试                         |

---

## 10. 附录

### 10.1 相关文档

| 文档                                           | 说明                |
| ---------------------------------------------- | ------------------- |
| [README.md](./README.md)                       | 项目总体开发规划    |
| [phase1-branding.md](./phase1-branding.md)     | 品牌替换详细方案    |
| [phase2-mcp-server.md](./phase2-mcp-server.md) | MCP Server 集成方案 |
| [phase3-knowledge.md](./phase3-knowledge.md)   | 知识增强方案        |
| [phase4-isqtools.md](./phase4-isqtools.md)     | isqtools 调用链方案 |
| [phase5-ux.md](./phase5-ux.md)                 | UX 优化方案         |
| [phase6-release.md](./phase6-release.md)       | 发布方案            |

### 10.2 测试工具

| 工具           | 用途                     | 版本要求       |
| -------------- | ------------------------ | -------------- |
| Vitest         | TypeScript 单元/集成测试 | 与项目依赖一致 |
| pytest         | Python MCP Server 测试   | ≥ 7.0          |
| Docker         | 沙箱环境                 | ≥ 24.x         |
| Docker Compose | 多服务编排（Qdrant 等）  | ≥ 2.x          |
