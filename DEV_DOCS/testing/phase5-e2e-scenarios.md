# Phase 5: 端到端场景测试 (L5 — E2E Scenario Tests)

> **预计工时:** 1.5 天 | **优先级:** P3 | **前置条件:** Phase 1-4 核心测试通过
> **负责人:** \***\*\_\_\_\_\*\*** | **执行日期:** \***\*\_\_\_\_\*\***

---

## 测试目的

模拟真实用户操作流程，验证完整工作流。每个场景独立可执行，可由不同测试人员并行负责。

---

## 环境准备

- [ ] Phase 1-4 核心测试（P0/P1）已全部通过
- [ ] 完整运行环境已就绪（Node.js, Python, Docker, Qdrant）
- [ ] `GEMINI_API_KEY` 和/或 `ZHIPU_API_KEY` 已配置
- [ ] isQCodeAgent MCP Server 已配置并可启动
- [ ] 测试数据文件已准备（`bell_state.isq`, `syntax_error.isq` 等）

---

## 场景 S1：首次启动与配置

> **负责人:** \***\*\_\_\_\_\*\***

| 步骤 | 操作                      | 预期结果                              | 状态 | 实际结果 |
| ---- | ------------------------- | ------------------------------------- | ---- | -------- |
| 1    | 首次运行 `isqcoder`       | 显示 ASCII 标志，弹出认证对话框       | 🔲   |          |
| 2    | 选择 Zhipu API Key 并输入 | 认证成功，创建 `~/.isqcoder/` 目录    | 🔲   |          |
| 3    | 进入一个新项目目录        | 弹出文件夹信任提示                    | 🔲   |          |
| 4    | 信任后输入 `/help`        | 显示帮助信息，包含量子命令列表        | 🔲   |          |
| 5    | 执行 `/qenv`              | 显示环境状态（Docker、MCP Server 等） | 🔲   |          |

**场景结论:** ☐ 通过 / ☐ 失败 / ☐ 部分通过

**备注:**

---

## 场景 S2：isQ 代码开发完整流程

> **负责人:** \***\*\_\_\_\_\*\*** | ⚠️ **发布阻塞场景**

| 步骤 | 操作                                      | 预期结果                               | 状态 | 实际结果 |
| ---- | ----------------------------------------- | -------------------------------------- | ---- | -------- |
| 1    | 对话："帮我写一个 Bell State 的 isQ 程序" | LLM 生成含 `H`, `CNOT` 的 isQ 代码     | 🔲   |          |
| 2    | 代码在终端以语法高亮渲染                  | `procedure`, `qbit`, `H` 等关键字着色  | 🔲   |          |
| 3    | 将代码保存为 `bell.isq`                   | 文件写入成功                           | 🔲   |          |
| 4    | 执行 `/qrun bell.isq`                     | 编译成功 → 模拟运行 → 返回概率分布     | 🔲   |          |
| 5    | 查看概率条形图                            | ASCII 图表显示 \|00⟩ 和 \|11⟩ 各约 50% | 🔲   |          |

**场景结论:** ☐ 通过 / ☐ 失败 / ☐ 部分通过

**备注:**

---

## 场景 S3：编译错误修复循环

> **负责人:** \***\*\_\_\_\_\*\***

| 步骤 | 操作                             | 预期结果                                     | 状态 | 实际结果 |
| ---- | -------------------------------- | -------------------------------------------- | ---- | -------- |
| 1    | 创建含语法错误的 `broken.isq`    | 文件保存成功                                 | 🔲   |          |
| 2    | 执行 `/qrun broken.isq`          | 编译失败，显示错误信息                       | 🔲   |          |
| 3    | 执行 `/qfix broken.isq`          | 自动修复循环启动，返回修正后的代码和修复说明 | 🔲   |          |
| 4    | 用修复后的代码替换并重新 `/qrun` | 编译通过，模拟正常运行                       | 🔲   |          |

**场景结论:** ☐ 通过 / ☐ 失败 / ☐ 部分通过

**备注:**

---

## 场景 S4：isqtools Python 混合编程

> **负责人:** \***\*\_\_\_\_\*\***

| 步骤 | 操作                                           | 预期结果                                    | 状态 | 实际结果 |
| ---- | ---------------------------------------------- | ------------------------------------------- | ---- | -------- |
| 1    | 对话："帮我用 Python isqtools 运行 Bell State" | LLM 生成 `.py` 文件和 `.isq` 文件           | 🔲   |          |
| 2    | 保存文件到当前目录                             | 两个文件写入成功                            | 🔲   |          |
| 3    | 执行 `/qpy run_bell.py`                        | 自动发现同目录 `.isq` 文件，Docker 中执行   | 🔲   |          |
| 4    | 查看 Python 输出                               | 显示量子模拟结果                            | 🔲   |          |
| 5    | 如有错误，对话："帮我修复"                     | LLM 调用 `isqtools_auto_fix` 分析错误并修复 | 🔲   |          |

**场景结论:** ☐ 通过 / ☐ 失败 / ☐ 部分通过

**备注:**

---

## 场景 S5：知识检索辅助编程

> **负责人:** \***\*\_\_\_\_\*\***

| 步骤 | 操作                                         | 预期结果                             | 状态 | 实际结果 |
| ---- | -------------------------------------------- | ------------------------------------ | ---- | -------- |
| 1    | 执行 `/qsearch Grover算法`                   | 返回 Grover 搜索相关的知识片段       | 🔲   |          |
| 2    | 对话："根据上面的知识，帮我实现 Grover 搜索" | LLM 结合 RAG 结果生成正确的 isQ 代码 | 🔲   |          |
| 3    | 执行 `/qtemplate grover`                     | 返回 Grover 搜索代码模板             | 🔲   |          |
| 4    | 对比 LLM 生成和模板                          | 两者结构一致，关键量子门正确         | 🔲   |          |

**场景结论:** ☐ 通过 / ☐ 失败 / ☐ 部分通过

**备注:**

---

## 场景 S6：多轮对话与上下文保持

> **负责人:** \***\*\_\_\_\_\*\***

| 步骤 | 操作                                | 预期结果                                | 状态 | 实际结果 |
| ---- | ----------------------------------- | --------------------------------------- | ---- | -------- |
| 1    | 对话："创建一个 3-qubit GHZ 态程序" | 生成正确的 GHZ 代码                     | 🔲   |          |
| 2    | 对话："把它改成 5-qubit"            | 在上下文中修改为 5-qubit 版本           | 🔲   |          |
| 3    | 对话："加上测量和打印"              | 在之前代码基础上添加 `M` 和 `print`     | 🔲   |          |
| 4    | 对话："编译运行一下"                | LLM 调用 `isq_compile` + `isq_simulate` | 🔲   |          |

**场景结论:** ☐ 通过 / ☐ 失败 / ☐ 部分通过

**备注:**

---

## 场景 S7：错误容错与异常恢复

> **负责人:** \***\*\_\_\_\_\*\***

| 步骤 | 操作                                    | 预期结果                                    | 状态 | 实际结果 |
| ---- | --------------------------------------- | ------------------------------------------- | ---- | -------- |
| 1    | 在 Docker 未启动时执行 `/qrun test.isq` | 显示友好错误信息（"Docker 未运行"类似提示） | 🔲   |          |
| 2    | 在 MCP Server 配置错误时启动            | 显示 MCP 连接失败信息，基础对话功能不受影响 | 🔲   |          |
| 3    | 在无网络时使用 LLM 对话                 | 显示网络错误提示，不崩溃                    | 🔲   |          |
| 4    | 在 Qdrant 未启动时执行 `/qsearch`       | 显示 RAG 服务不可用提示                     | 🔲   |          |

**场景结论:** ☐ 通过 / ☐ 失败 / ☐ 部分通过

**备注:**

---

## 测试结果汇总

| 场景                        | 步骤数 | 通过 | 失败 | 结论 |
| --------------------------- | ------ | ---- | ---- | ---- |
| S1 首次启动与配置           | 5      |      |      |      |
| S2 isQ 代码开发完整流程 ⚠️  | 5      |      |      |      |
| S3 编译错误修复循环         | 4      |      |      |      |
| S4 isqtools Python 混合编程 | 5      |      |      |      |
| S5 知识检索辅助编程         | 4      |      |      |      |
| S6 多轮对话与上下文保持     | 4      |      |      |      |
| S7 错误容错与异常恢复       | 4      |      |      |      |
| **合计**                    | **31** |      |      |      |

---

## 阻塞问题记录

| #   | 问题描述 | 所属场景 | 严重程度 | 状态 |
| --- | -------- | -------- | -------- | ---- |
|     |          |          |          |      |

---

## 签字确认

- **测试执行人:** \***\*\_\_\_\_\*\***
- **完成日期:** \***\*\_\_\_\_\*\***
- **结论:** ☐ 全部场景通过，可发布 / ☐ 存在阻塞问题，需修复后重测 /
  ☐ 已记录 Known Issues，可降级发布
