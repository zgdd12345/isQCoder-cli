# Phase 2: 单元回归 (L2 — 单元测试)

> **预计工时:** 1 天 | **优先级:** P0/P1 | **前置条件:** Phase 1 通过
> **负责人:** ****\_\_\_\_**** | **执行日期:** ****\_\_\_\_****

---

## 测试目的

验证各模块的独立功能正确性，包括品牌替换验证、isQ 语法高亮、System
Prompt 生成、静态知识资源、Zhipu 内容生成器，以及现有单元测试回归。

---

## 环境准备

- [ ] Phase 1 构建验证已全部通过
- [ ] `npm run build` 已成功执行
- [ ] 环境变量 `ZHIPU_API_KEY` 已配置（L2-23、L2-24 需要）

---

## 测试用例

### 4.2.1 品牌替换验证

#### L2-01 配置目录名称

| 项目         | 内容                       |
| ------------ | -------------------------- |
| **编号**     | L2-01                      |
| **测试项**   | 配置目录名称               |
| **验证方法** | 检查 `ISQCODER_DIR` 常量值 |
| **预期结果** | 值为 `.isqcoder`           |
| **状态**     | 🔲                         |
| **实际结果** |                            |
| **备注**     |                            |

#### L2-02 上下文文件名

| 项目         | 内容                                   |
| ------------ | -------------------------------------- |
| **编号**     | L2-02                                  |
| **测试项**   | 上下文文件名                           |
| **验证方法** | 检查 `DEFAULT_CONTEXT_FILENAME` 常量值 |
| **预期结果** | 值为 `ISQCODER.md`                     |
| **状态**     | 🔲                                     |
| **实际结果** |                                        |
| **备注**     |                                        |

#### L2-03 内存段标题

| 项目         | 内容                       |
| ------------ | -------------------------- |
| **编号**     | L2-03                      |
| **测试项**   | 内存段标题                 |
| **验证方法** | 检查 memory section header |
| **预期结果** | 包含 `isQCoder`            |
| **状态**     | 🔲                         |
| **实际结果** |                            |
| **备注**     |                            |

#### L2-04 包名引用

| 项目         | 内容                                                |
| ------------ | --------------------------------------------------- |
| **编号**     | L2-04                                               |
| **测试项**   | 包名引用                                            |
| **验证方法** | 全局搜索 `@google/gemini-cli` 残留                  |
| **预期结果** | 源码中不存在旧包名引用（保留的兼容别名除外）        |
| **状态**     | 🔲                                                  |
| **实际结果** |                                                     |
| **备注**     | 使用 `grep -rn "@google/gemini-cli" packages/` 检查 |

#### L2-05 二进制入口

| 项目         | 内容                                   |
| ------------ | -------------------------------------- |
| **编号**     | L2-05                                  |
| **测试项**   | 二进制入口                             |
| **验证方法** | 检查 root `package.json` 的 `bin` 字段 |
| **预期结果** | 值为 `isqcoder` → `bundle/isqcoder.js` |
| **状态**     | 🔲                                     |
| **实际结果** |                                        |
| **备注**     |                                        |

#### L2-06 系统设置路径

| 项目         | 内容                                 |
| ------------ | ------------------------------------ |
| **编号**     | L2-06                                |
| **测试项**   | 系统设置路径                         |
| **验证方法** | 检查 Linux/Windows 系统设置路径常量  |
| **预期结果** | Linux: `/etc/isqcoder/settings.json` |
| **状态**     | 🔲                                   |
| **实际结果** |                                      |
| **备注**     |                                      |

#### L2-07 ASCII 标志

| 项目         | 内容                                           |
| ------------ | ---------------------------------------------- |
| **编号**     | L2-07                                          |
| **测试项**   | ASCII 标志                                     |
| **验证方法** | 渲染 AsciiArt 组件（short/long/tiny 三种变体） |
| **预期结果** | 输出包含 `isQCoder` 文案                       |
| **状态**     | 🔲                                             |
| **实际结果** |                                                |
| **备注**     |                                                |

#### L2-08 提示文案

| 项目         | 内容                     |
| ------------ | ------------------------ |
| **编号**     | L2-08                    |
| **测试项**   | 提示文案                 |
| **验证方法** | 检查 Tips 组件输出       |
| **预期结果** | 不包含 `Gemini CLI` 字样 |
| **状态**     | 🔲                       |
| **实际结果** |                          |
| **备注**     |                          |

---

### 4.2.2 isQ 语法高亮

#### L2-09 语言定义注册

| 项目         | 内容                                                    |
| ------------ | ------------------------------------------------------- |
| **编号**     | L2-09                                                   |
| **测试项**   | 语言定义注册                                            |
| **验证方法** | `lowlight` 注册 `isq` 语言后 `listLanguages()` 含 `isq` |
| **预期结果** | 注册成功                                                |
| **状态**     | 🔲                                                      |
| **实际结果** |                                                         |
| **备注**     |                                                         |

#### L2-10 关键字高亮

| 项目         | 内容                                                         |
| ------------ | ------------------------------------------------------------ |
| **编号**     | L2-10                                                        |
| **测试项**   | 关键字高亮                                                   |
| **验证方法** | 对含 `procedure`, `qbit`, `ctrl`, `deriving gate` 的代码高亮 |
| **预期结果** | 关键字被正确分类和标注                                       |
| **状态**     | 🔲                                                           |
| **实际结果** |                                                              |
| **备注**     |                                                              |

#### L2-11 量子门内置函数

| 项目         | 内容                                         |
| ------------ | -------------------------------------------- |
| **编号**     | L2-11                                        |
| **测试项**   | 量子门内置函数                               |
| **验证方法** | 对含 `H`, `CNOT`, `Toffoli`, `Rx` 的代码高亮 |
| **预期结果** | 内置函数被正确识别                           |
| **状态**     | 🔲                                           |
| **实际结果** |                                              |
| **备注**     |                                              |

#### L2-12 CodeColorizer 集成

| 项目         | 内容                                  |
| ------------ | ------------------------------------- |
| **编号**     | L2-12                                 |
| **测试项**   | CodeColorizer 集成                    |
| **验证方法** | `CodeColorizer` 处理 `isq` 语言代码块 |
| **预期结果** | 输出带 ANSI 颜色的终端文本            |
| **状态**     | 🔲                                    |
| **实际结果** |                                       |
| **备注**     |                                       |

---

### 4.2.3 System Prompt 生成

#### L2-13 isQ 知识注入

| 项目         | 内容                                    |
| ------------ | --------------------------------------- |
| **编号**     | L2-13                                   |
| **测试项**   | isQ 知识注入                            |
| **验证方法** | 调用 `renderIsqKnowledge()` 函数        |
| **预期结果** | 返回包含 isQ 语法规则、量子门列表的文本 |
| **状态**     | 🔲                                      |
| **实际结果** |                                         |
| **备注**     |                                         |

#### L2-14 isqtools 工作流注入

| 项目         | 内容                                  |
| ------------ | ------------------------------------- |
| **编号**     | L2-14                                 |
| **测试项**   | isqtools 工作流注入                   |
| **验证方法** | 调用 `renderIsqtoolsWorkflow()` 函数  |
| **预期结果** | 返回包含 3 种编程模式、调用步骤的文本 |
| **状态**     | 🔲                                    |
| **实际结果** |                                       |
| **备注**     |                                       |

#### L2-15 Prompt 始终启用

| 项目         | 内容                                          |
| ------------ | --------------------------------------------- |
| **编号**     | L2-15                                         |
| **测试项**   | Prompt 始终启用                               |
| **验证方法** | 检查 promptProvider 配置                      |
| **预期结果** | `isqKnowledge` 和 `isqtoolsWorkflow` 始终启用 |
| **状态**     | 🔲                                            |
| **实际结果** |                                               |
| **备注**     |                                               |

#### L2-16 身份标识

| 项目         | 内容                                        |
| ------------ | ------------------------------------------- |
| **编号**     | L2-16                                       |
| **测试项**   | 身份标识                                    |
| **验证方法** | 获取完整 system prompt                      |
| **预期结果** | 包含 "isQCoder" 和 "quantum computing" 描述 |
| **状态**     | 🔲                                          |
| **实际结果** |                                             |
| **备注**     |                                             |

---

### 4.2.4 静态知识资源

#### L2-17 isQ 快速参考文档

| 项目         | 内容                               |
| ------------ | ---------------------------------- |
| **编号**     | L2-17                              |
| **测试项**   | isQ 快速参考文档                   |
| **验证方法** | 读取 `isq-quick-reference.md`      |
| **预期结果** | 文档存在且包含类型定义、量子门用法 |
| **状态**     | 🔲                                 |
| **实际结果** |                                    |
| **备注**     |                                    |

#### L2-18 isqtools 快速入门

| 项目         | 内容                             |
| ------------ | -------------------------------- |
| **编号**     | L2-18                            |
| **测试项**   | isqtools 快速入门                |
| **验证方法** | 读取 `isqtools-quick-start.md`   |
| **预期结果** | 文档存在且包含安装说明、API 用法 |
| **状态**     | 🔲                               |
| **实际结果** |                                  |
| **备注**     |                                  |

#### L2-19 量子算法模式

| 项目         | 内容                                             |
| ------------ | ------------------------------------------------ |
| **编号**     | L2-19                                            |
| **测试项**   | 量子算法模式                                     |
| **验证方法** | 读取 `quantum-patterns.md`                       |
| **预期结果** | 包含 Bell State、GHZ、Grover、量子隐形传态等示例 |
| **状态**     | 🔲                                               |
| **实际结果** |                                                  |
| **备注**     |                                                  |

#### L2-20 资源注册表

| 项目         | 内容                             |
| ------------ | -------------------------------- |
| **编号**     | L2-20                            |
| **测试项**   | 资源注册表                       |
| **验证方法** | 检查 `resource-registry.ts` 导出 |
| **预期结果** | 所有 3 个资源文件均已注册        |
| **状态**     | 🔲                               |
| **实际结果** |                                  |
| **备注**     |                                  |

---

### 4.2.5 Zhipu 内容生成器

#### L2-21 类实例化

| 项目         | 内容                                |
| ------------ | ----------------------------------- |
| **编号**     | L2-21                               |
| **测试项**   | 类实例化                            |
| **验证方法** | `new ZhipuContentGenerator(apiKey)` |
| **预期结果** | 无异常，默认模型为 `glm-5`          |
| **状态**     | 🔲                                  |
| **实际结果** |                                     |
| **备注**     |                                     |

#### L2-22 Token 计数

| 项目         | 内容                                     |
| ------------ | ---------------------------------------- |
| **编号**     | L2-22                                    |
| **测试项**   | Token 计数                               |
| **验证方法** | `countTokens()` 对中英文文本             |
| **预期结果** | 返回基于字符的估算值（中文: 字符数×1.5） |
| **状态**     | 🔲                                       |
| **实际结果** |                                          |
| **备注**     |                                          |

#### L2-23 API Base URL 覆盖

| 项目         | 内容                               |
| ------------ | ---------------------------------- |
| **编号**     | L2-23                              |
| **测试项**   | API Base URL 覆盖                  |
| **验证方法** | 设置 `ZHIPU_API_BASE_URL` 环境变量 |
| **预期结果** | 使用自定义地址而非默认地址         |
| **状态**     | 🔲                                 |
| **实际结果** |                                    |
| **备注**     |                                    |

#### L2-24 Auth 类型检测

| 项目         | 内容                                    |
| ------------ | --------------------------------------- |
| **编号**     | L2-24                                   |
| **测试项**   | Auth 类型检测                           |
| **验证方法** | 设置 `ZHIPU_API_KEY` 环境变量           |
| **预期结果** | `getAuthTypeFromEnv()` 返回 `USE_ZHIPU` |
| **状态**     | 🔲                                      |
| **实际结果** |                                         |
| **备注**     |                                         |

---

### 4.2.6 现有单元测试回归

#### L2-25 CLI 包单元测试

| 项目         | 内容                           |
| ------------ | ------------------------------ |
| **编号**     | L2-25                          |
| **测试项**   | CLI 包单元测试                 |
| **执行命令** | `npm run test -w packages/cli` |
| **预期结果** | 所有测试通过                   |
| **状态**     | 🔲                             |
| **实际结果** |                                |
| **备注**     |                                |

#### L2-26 Core 包单元测试

| 项目         | 内容                            |
| ------------ | ------------------------------- |
| **编号**     | L2-26                           |
| **测试项**   | Core 包单元测试                 |
| **执行命令** | `npm run test -w packages/core` |
| **预期结果** | 所有测试通过                    |
| **状态**     | 🔲                              |
| **实际结果** |                                 |
| **备注**     |                                 |

#### L2-27 SDK 包单元测试

| 项目         | 内容                           |
| ------------ | ------------------------------ |
| **编号**     | L2-27                          |
| **测试项**   | SDK 包单元测试                 |
| **执行命令** | `npm run test -w packages/sdk` |
| **预期结果** | 所有测试通过                   |
| **状态**     | 🔲                             |
| **实际结果** |                                |
| **备注**     |                                |

#### L2-28 Test-Utils 包单元测试

| 项目         | 内容                                  |
| ------------ | ------------------------------------- |
| **编号**     | L2-28                                 |
| **测试项**   | Test-Utils 包单元测试                 |
| **执行命令** | `npm run test -w packages/test-utils` |
| **预期结果** | 所有测试通过                          |
| **状态**     | 🔲                                    |
| **实际结果** |                                       |
| **备注**     |                                       |

#### L2-29 脚本测试

| 项目         | 内容                   |
| ------------ | ---------------------- |
| **编号**     | L2-29                  |
| **测试项**   | 脚本测试               |
| **执行命令** | `npm run test:scripts` |
| **预期结果** | 所有测试通过           |
| **状态**     | 🔲                     |
| **实际结果** |                        |
| **备注**     |                        |

---

## 测试结果汇总

| 编号  | 状态 | 实际结果 | 备注 |
| ----- | ---- | -------- | ---- |
| L2-01 | 🔲   |          |      |
| L2-02 | 🔲   |          |      |
| L2-03 | 🔲   |          |      |
| L2-04 | 🔲   |          |      |
| L2-05 | 🔲   |          |      |
| L2-06 | 🔲   |          |      |
| L2-07 | 🔲   |          |      |
| L2-08 | 🔲   |          |      |
| L2-09 | 🔲   |          |      |
| L2-10 | 🔲   |          |      |
| L2-11 | 🔲   |          |      |
| L2-12 | 🔲   |          |      |
| L2-13 | 🔲   |          |      |
| L2-14 | 🔲   |          |      |
| L2-15 | 🔲   |          |      |
| L2-16 | 🔲   |          |      |
| L2-17 | 🔲   |          |      |
| L2-18 | 🔲   |          |      |
| L2-19 | 🔲   |          |      |
| L2-20 | 🔲   |          |      |
| L2-21 | 🔲   |          |      |
| L2-22 | 🔲   |          |      |
| L2-23 | 🔲   |          |      |
| L2-24 | 🔲   |          |      |
| L2-25 | 🔲   |          |      |
| L2-26 | 🔲   |          |      |
| L2-27 | 🔲   |          |      |
| L2-28 | 🔲   |          |      |
| L2-29 | 🔲   |          |      |

**通过率:** _/29 ( _%)

---

## 阻塞问题记录

| #   | 问题描述 | 影响范围 | 严重程度 | 状态 |
| --- | -------- | -------- | -------- | ---- |
|     |          |          |          |      |

---

## 签字确认

- **测试执行人:** ****\_\_\_\_****
- **完成日期:** ****\_\_\_\_****
- **结论:** ☐ 全部通过，可进入 Phase 3 / ☐ 存在阻塞问题，需修复后重测
